---
import { SnipcartProduct, ProductMeta } from '@lloydjatkinson/astro-snipcart';
import { Product } from '@lloydjatkinson/astro-snipcart/astro';
import { constants } from 'crypto';

import { Element, ProductCard } from './types';

// export type Props = Element & {
//     readonly title: string;
//     readonly variants: readonly string[];
//     readonly formattedPrice: string;
//     readonly image: string;
// };
// const { as: Element = 'div', title, variants, formattedPrice, image } = Astro.props as Props;

export type Props = Element & SnipcartProduct & ProductMeta & {
    readonly currency: string;
};

const { as: Element = 'div', id, name, image, price, currency, variants } = Astro.props as Props;
const product = Astro.props as SnipcartProduct & ProductMeta;

const isCurrencyString = typeof price === 'string';
const isCurrencyObject = typeof price === 'object';

// TODO: Need to determine a developer ergonmic way to handle this.
// If the consumer is using Snipcart multi-currency support we don't get given this information by Snipcart.
// We need to possibly allow the consumer to set this up perhaps within SnipcartSetup, or pass a prop to every place prices are used.
const formattedPrice = new Intl.NumberFormat('en', { style: 'currency', currency: currency }).format(price);
---

<Element>
          <div class="relative">
        <div class="w-full min-h-80 bg-gray-200 aspect-square overflow-hidden lg:h-80 lg:aspect-none">
          <img src={ image } alt="Front of men&#039;s Basic Tee in black." class="w-full h-full object-center object-cover lg:w-full lg:h-full">
        </div>
        <div class="mt-4 flex justify-between">
          <div>
            <h3 class="text-sm text-gray-700">
              <a href={ `/products/${id}` }>
                <span aria-hidden="true" class="absolute inset-0"></span>
                { name }
              </a>
            </h3>
            <p class="mt-1 text-sm text-gray-500">{ variants?.join(', ') }</p>
          </div>
          <p class="text-sm font-medium text-gray-900">{ formattedPrice }</p>
        </div>
      </div>
</Element>
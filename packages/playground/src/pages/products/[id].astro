---
import { SnipcartProduct } from '@lloydjatkinson/astro-snipcart';
import { Product } from '@lloydjatkinson/astro-snipcart/astro';
// TODO: Use ProductLayout.astro
import { PageLayout } from '@lloydjatkinson/astro-snipcart-design-system/astro';

import PlaygroundLayout from '../../layouts/PlaygroundLayout.astro';

export async function getStaticPaths() {
    const productIds = (await Astro.glob<SnipcartProduct>('../../../products/*.md'))
        .map(product => ({ params: { id: product.frontmatter.id } }));
    return productIds;
};

const products = await Astro.glob<SnipcartProduct>('../../../products/*.md');
const { id } = Astro.params;
const product: SnipcartProduct = products.find((product) => product.frontmatter.id === id).frontmatter;

const {
    name,
    price,
    description,
    image,
    categories,
    metadata,
    quantity,
    minimumQuantity,
    maximumQuantity,
    quantityStep,
    dimensions,
    customFields,
    stackable,
    shippable,
    taxable,
    taxes,
    hasTaxesIncluded,
} = product;
---
<PlaygroundLayout>
    <PageLayout
        title={ name }
        description={ description }>
        <div>
            <h1>{name}</h1>
            <p>{id}</p>
            <p>{description}</p>
            <p>{price}</p>
        </div>

        <Product
            { ...product }>
            <button>
                Buy
            </button>
        </Product>
    </PageLayout>
</PlaygroundLayout>